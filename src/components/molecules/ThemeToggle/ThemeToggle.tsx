'use client';

import React from 'react';
import { useThemeStore, type Theme } from '@/stores/useThemeStore';

export interface ThemeToggleProps {
  variant?: 'icon' | 'switch' | 'buttons';
  showLabel?: boolean;
  className?: string;
  dictionary?: {
    light: string;
    dark: string;
    system: string;
    toggleTheme: string;
  };
}

const SunIcon: React.FC = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 20 20"
    fill="currentColor"
    className="w-5 h-5"
    aria-hidden="true"
  >
    <path d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM10 15a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 15zM10 7a3 3 0 100 6 3 3 0 000-6zM15.657 5.404a.75.75 0 10-1.06-1.06l-1.061 1.06a.75.75 0 001.06 1.061l1.06-1.06zM6.464 14.596a.75.75 0 10-1.06-1.06l-1.06 1.06a.75.75 0 001.06 1.06l1.06-1.06zM18 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0118 10zM5 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 015 10zM14.596 15.657a.75.75 0 001.06-1.06l-1.06-1.061a.75.75 0 10-1.061 1.06l1.06 1.06zM5.404 6.464a.75.75 0 001.06-1.06l-1.06-1.06a.75.75 0 10-1.061 1.06l1.06 1.06z" />
  </svg>
);

const MoonIcon: React.FC = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 20 20"
    fill="currentColor"
    className="w-5 h-5"
    aria-hidden="true"
  >
    <path
      fillRule="evenodd"
      d="M7.455 2.004a.75.75 0 01.26.77 7 7 0 009.958 7.967.75.75 0 011.067.853A8.5 8.5 0 116.647 1.921a.75.75 0 01.808.083z"
      clipRule="evenodd"
    />
  </svg>
);

const SystemIcon: React.FC = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 20 20"
    fill="currentColor"
    className="w-5 h-5"
    aria-hidden="true"
  >
    <path
      fillRule="evenodd"
      d="M2 4.25A2.25 2.25 0 014.25 2h11.5A2.25 2.25 0 0118 4.25v8.5A2.25 2.25 0 0115.75 15h-3.105a3.501 3.501 0 001.1 1.677A.75.75 0 0113.26 18H6.74a.75.75 0 01-.484-1.323A3.501 3.501 0 007.355 15H4.25A2.25 2.25 0 012 12.75v-8.5zm1.5 0a.75.75 0 01.75-.75h11.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75H4.25a.75.75 0 01-.75-.75v-7.5z"
      clipRule="evenodd"
    />
  </svg>
);

const ThemeToggle: React.FC<ThemeToggleProps> = ({
  variant = 'icon',
  showLabel = false,
  className = '',
  dictionary = {
    light: 'Light',
    dark: 'Dark',
    system: 'System',
    toggleTheme: 'Toggle theme',
  },
}) => {
  const { theme, setTheme, toggleTheme, getEffectiveTheme } = useThemeStore();
  const effectiveTheme = getEffectiveTheme();

  const themes: Theme[] = ['light', 'dark', 'system'];

  const getIcon = (t: Theme) => {
    switch (t) {
      case 'light':
        return <SunIcon />;
      case 'dark':
        return <MoonIcon />;
      case 'system':
        return <SystemIcon />;
    }
  };

  const getLabel = (t: Theme) => {
    switch (t) {
      case 'light':
        return dictionary.light;
      case 'dark':
        return dictionary.dark;
      case 'system':
        return dictionary.system;
    }
  };

  // Icon variant - simple toggle button
  if (variant === 'icon') {
    return (
      <button
        onClick={toggleTheme}
        className={`
          p-2 rounded-lg transition-colors
          text-gray-600 dark:text-gray-300
          hover:bg-gray-100 dark:hover:bg-gray-800
          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
          dark:focus:ring-offset-gray-900
          ${className}
        `}
        aria-label={dictionary.toggleTheme}
        title={dictionary.toggleTheme}
      >
        {effectiveTheme === 'dark' ? <SunIcon /> : <MoonIcon />}
        {showLabel && (
          <span className="ml-2 text-sm font-medium">
            {effectiveTheme === 'dark' ? dictionary.light : dictionary.dark}
          </span>
        )}
      </button>
    );
  }

  // Switch variant - toggle switch
  if (variant === 'switch') {
    const isDark = effectiveTheme === 'dark';
    return (
      <button
        onClick={toggleTheme}
        className={`
          relative inline-flex h-6 w-11 items-center rounded-full transition-colors
          focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
          dark:focus:ring-offset-gray-900
          ${isDark ? 'bg-blue-600' : 'bg-gray-200'}
          ${className}
        `}
        role="switch"
        aria-checked={isDark}
        aria-label={dictionary.toggleTheme}
      >
        <span
          className={`
            inline-flex h-4 w-4 items-center justify-center rounded-full bg-white transition-transform
            ${isDark ? 'translate-x-6' : 'translate-x-1'}
          `}
        >
          {isDark ? (
            <MoonIcon />
          ) : (
            <SunIcon />
          )}
        </span>
      </button>
    );
  }

  // Buttons variant - segmented control
  return (
    <div
      className={`inline-flex items-center gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg ${className}`}
      role="group"
      aria-label="Theme selection"
    >
      {themes.map((t) => {
        const isActive = theme === t;
        return (
          <button
            key={t}
            onClick={() => setTheme(t)}
            className={`
              flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-md transition-colors
              focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1
              ${
                isActive
                  ? 'bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 shadow-sm'
                  : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100'
              }
            `}
            aria-pressed={isActive}
            aria-label={`Set theme to ${getLabel(t)}`}
          >
            {getIcon(t)}
            {showLabel && <span>{getLabel(t)}</span>}
          </button>
        );
      })}
    </div>
  );
};

export default ThemeToggle;
